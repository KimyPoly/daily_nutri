
<% d = Time.now.day%>
<% m = Time.now.month%>
<% y = Time.now.year %>
<% m31 = [1,3,5,7,8,10,12] %>
<% fev = 2 %>
<% we = (d..d + 6).to_a %>

<%if m31.include?(m)%>
  <% we.map! { |valeur| valeur > 31 ? valeur -= 31 : valeur } %>
<%  elsif m == fev %>
    <% if y/4 == Integer %>
      <% we.map! { |valeur| valeur > 29 ? valeur -= 29 : valeur } %>
    <% else %>
      <% we.map! { |valeur| valeur > 28 ? valeur -= 28 : valeur } %>
    <% end %>
<% else %>
  <% we.map! { |valeur| valeur > 30 ? valeur -= 30 : valeur } %>
<% end %>
<div class="bubble_list">
  <% we.each do |day| %>
    <div class="bubble_container"><a class="calendar_bubble" href="http://127.0.0.1:3000/dashboard"><%= day %></a></div>
  <% end %>
</div>

<h1>Meal plan </h1>

<div>
  <h2>Meals</h2>
  <h1>Repas associés au programme :</h1>
  <ul>
    <% @program.meal_assignements.each do |meal_assignment| %>
      <li>
        <%= link_to meal_assignment.meal.name, program_meal_path(meal_assignment.meal) %>
      </li>
      <li><%= meal_assignment.meal.time %></li>
      <li><%= meal_assignment.meal.price %></li>
    <% end %>
  </ul>
</div>

<div class="">
  <h2>Meals</h2>
  <div class="meal-container">
  <div class="meal-card">
  <div class="img-container" style="background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS8qIyI-mJ5SOYBT69LczTLjLrnJhCC0Sc9JA&usqp=CAU')"></div>
    <div class="meal-card-info">
      <h3>Breakfast</h3>
      <% found_breakfast = false %>
      <% @program.meal_assignements.each do |meal_assignment| %>
        <% if meal_assignment.meal.meal_type == "breakfast" && !found_breakfast %>
        <% found_breakfast = true %>
          <ul>
            <li><span>🍽️</span> <%= meal_assignment.meal.name %></li>
            <li><span>⌛</span> <%= meal_assignment.meal.time %></li>
            <li><span>💰</span> <%= meal_assignment.meal.price %></li>
          </ul>
        <% end %>
      <% end %>
    </div>
  </div>
  <div class="meal-card">
  <div class="img-container"></div>
    <div class="meal-card-info">
    <h3>Lunch</h3>
    <% found_dish = false %>
    <% @meals.each_with_index do |meal, index| %>
      <% next if index.even? %>
        <% if meal.meal_type == "dish" && !found_dish %>
          <% found_dish = true %>
          <ul>
            <li><span>🍽️</span> <%= meal_assignment.meal.name %></li>
            <li><span>⌛</span> <%= meal_assignment.meal.time %></li>
            <li><span>💰</span> <%= meal.price %></li>
          </ul>
        <% end %>
      <% end %>
    </div>
  </div>
<div class="meal-card">
  <div class="img-container"></div>
  <div class="meal-card-info">
    <h3>Dinner</h3>
    <% found_dish = false %>
    <% @program.meal_assignements.each_with_index do |meal_assignment, index| %>
      <% next if index.odd? %>
      <% if meal_assignment.meal.meal_type == "dish" && !found_dish %>
        <% found_dish = true %>
        <ul>
          <li><span>🍽️</span> <%= meal_assignment.meal.name %></li>
          <li><span>⌛</span> <%= meal_assignment.meal.time %></li>
          <li><span>💰</span> <%= meal_assignment.meal.price %></li> 
        </ul>
      <% end %>
    <% end %>
  </div>
</div>
<div class=btn-back-and-groceries>
  <%= link_to "Back", dashboard_path, class: "btn-home" %>
  <%= link_to "Groceries list", "#", class: "btn-home" %>
</div>
  <div data-controller="toggle">
    <button data-action="click->toggle#action" class="btn-home">Edit</button>
    <div class="display-none" data-toggle-target="form">
    <%= render partial: 'shared/form_new', locals: { program: @program } %>
  </div>
</div>
 </div>
